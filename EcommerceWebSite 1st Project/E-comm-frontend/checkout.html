<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>neoshop ‚Ä¢ Checkout</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    body {
      background-color: #ffffff !important; /* full white */
      color: #000000; /* text black for contrast */
    }
    .card {
      background-color: #ffffff; 
      border: 1px solid #e0e0e0;
    }
    .form-label, h2, h3, #summary {
      color: #000000 !important; /* labels and headings black */
    }
    .btn-primary {
      background-color: #000000; 
      border-color: #000000;
    }
    .btn-primary:hover {
      background-color: #333333; 
      border-color: #333333;
    }
    .dropdown-menu {
      background-color: #ffffff;
    }
    .dropdown-item {
      color: #000000;
    }
    .dropdown-item:hover {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body>
  <div id="app-header"></div>
  <main class="container my-4">
    <h2>Checkout</h2>
    <div class="row g-4">
      <!-- Main section -->
      <section class="col-md-8">
        <div class="card p-4 shadow-sm">
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input id="name" class="form-control" placeholder="Name"/>
          </div>
          <div class="mb-3">
            <label for="addr" class="form-label">Address</label>
            <input id="addr" class="form-control" placeholder="Address"/>
          </div>
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input id="city" class="form-control" placeholder="City"/>
          </div>
          <div class="mb-3">
            <label class="form-label">Payment Method</label>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" id="paymentDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Select Payment Method
              </button>
              <ul class="dropdown-menu w-100" aria-labelledby="paymentDropdown">
                <li><a class="dropdown-item" href="#" data-method="card">üí≥ Credit/Debit Card</a></li>
                <li><a class="dropdown-item" href="#" data-method="upi">üì± UPI</a></li>
                <li><a class="dropdown-item" href="#" data-method="cod">üöö Cash on Delivery</a></li>
              </ul>
            </div>
            <input type="hidden" id="pay" />
          </div>
          <button id="place" class="btn btn-primary w-100 mt-3">Place Order</button>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="col-md-4">
        <div class="card p-3 shadow-sm">
          <h3>Summary</h3>
          <div id="summary" class="text-muted">Loading‚Ä¶</div>
        </div>
      </aside>
    </div>
  </main>
  <div id="app-footer"></div>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
    import { mountHeader, mountFooter, isLoggedIn } from './js/layout.js';
    import { apiGet, apiSend, money, getUserId } from './js/api.js';

    if (!isLoggedIn()) {
      location.href = 'auth.html';
    }

    async function loadSummary(){
      const uid = getUserId();
      try{
        const t = await apiGet(`/api/cart/${encodeURIComponent(uid)}/total`);
        const totalNum = typeof t === 'number' ? t : (t.total || t.amount || 0);
        document.getElementById('summary').textContent = 'Total: ' + money(totalNum);
      }catch{
        document.getElementById('summary').textContent = 'Total: ‚Äî';
      }
    }

    // Dropdown selection handler
    document.querySelectorAll('.dropdown-item').forEach(item=>{
      item.addEventListener('click', (e)=>{
        e.preventDefault();
        const method = item.getAttribute('data-method');
        document.getElementById('pay').value = method;
        document.getElementById('paymentDropdown').textContent = item.textContent;
      });
    });

    // Place order
    document.getElementById('place').addEventListener('click', async ()=>{
      const uid = getUserId();
      const payMethod = document.getElementById('pay').value;
      if (!payMethod) {
        alert('‚ö†Ô∏è Please select a payment method');
        return;
      }
      try{
        await apiSend('POST', `/api/orders/place/${encodeURIComponent(uid)}`, { payment: payMethod });
        alert('‚úÖ Order placed!');
        location.href = 'orders.html';
      }catch(err){
        alert('‚ùå Failed to place order: ' + err.message);
      }
    });

    mountHeader('checkout'); 
    mountFooter(); 
    loadSummary();
  </script>
</body>
</html>
